---
import Traje from "../components/traje.astro";
import Vesitdo from "../components/vesitdo.astro";
import Layout from "../layouts/Layout.astro";
import { actions } from "astro:actions";
---

<Layout>
  <main transition:persist class="font-cinzel">
    <section
      class="w-full h-dvh min:h-dvh md:min-h-screen flex flex-col gap-10 justify-end items-center relative px-10 py-10"
    >
      <div
        class="w-full h-full absolute -z-10 inset-0 bg-gradient-to-b from-black via-white via-90% to-white"
      >
        <picture class="opacity-40">
          <source
            srcset="Imagen-fondo.webp"
            type="image/webp"
            media="(min-width: 769px)"
          />
          <source
            srcset="Imagen-fondo-mobile.webp"
            type="image/webp"
            media="(max-width: 768px)"
          />
          <img
            src="Imagen-fondo.webp"
            alt="imagen belu & rodri2"
            class="object-cover h-full w-full md:object-center"
          />
        </picture>
      </div>

      <h1 class="text-white text-center font-great tracking-wider text-6xl italic">
        Belu & Rodri
      </h1>
      <div
        class="flex flex-col items-center justify-center gap-2 text-white text-xl px-10 py-4 rounded-lg font-bold backdrop-blur-sm bg-[#c4e9ff]/30"
      >
        <p class="text-2xl">Nos casamos en</p>
        <div class="flex gap-4 items-center justify-evenly">
          <div class="flex flex-col w-10 h-10 items-center">
            <span class="text-2xl" id="dias">00</span><span class="text-xs"
              >dias</span
            >
          </div> :
          <div class="flex flex-col w-10 h-10 items-center">
            <span class="text-2xl" id="horas">00</span><span class="text-xs"
              >horas</span
            >
          </div> :
          <div class="flex flex-col w-10 h-10 items-center">
            <span class="text-2xl" id="minutos">00</span><span class="text-xs"
              >minutos</span
            >
          </div> :
          <div class="flex flex-col w-10 h-10 items-center">
            <span class="text-2xl" id="segundos">00</span><span class="text-xs"
              >segundos</span
            >
          </div>
        </div>
        <a
          class="uppercase bg-[#6a8477] text-white px-6 py-3 rounded-xl font-bold mt-6"
          href="#info">M√°s Info</a
        >
      </div>
    </section>
    <section
      id="info"
      class="min-h-screen flex flex-col py-10 items-center px-10"
    >
      <img
        class="self-center w-[250px] mb-10"
        src="3.png"
        alt="linea-corazon"
      />
      <img
        class="aspect-square w-[100px]"
        src="copas.png"
        alt="imagen de copas"
      />
      <p class="text-4xl mb-10 font-bold text-[#6a8477]">La Fiesta</p>
      <img
        class="aspect-[800x533] w-[400px] self-center rounded-lg"
        src="janos.jpg"
        alt="janos olivos"
        loading="lazy"
      />
      <div class="mt-10 flex flex-col gap-6 max-w-[350px] text-center">
        <p>
          <span class="font-black text-[#6a8477]">Fecha</span>: Domingo 2 de
          Marzo
        </p>
        <p><span class="font-black text-[#6a8477]">Hora</span>: 19:00 hs</p>
        <p>
          <span class="font-black text-[#6a8477]">Sal√≥n</span>: Janos Olivos I,
          Mariano Pelliza 310, Olivos, Provincia de Buenos Aires.
        </p>
        <a
          class="self-center text-white bg-[#6a8477] flex px-8 py-4 gap-2 rounded-xl"
          href="https://maps.app.goo.gl/nqccH8DfVfz2MFYe8"
          target="_blank"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-map-pin"
            ><path
              d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"
            ></path><circle cx="12" cy="10" r="3"></circle></svg
          > Llegar a la fiesta
        </a>
        <img
          class="self-center w-[250px] mt-10"
          src="3.png"
          alt="linea-corazon"
        />

        <div class="flex flex-col gap-4 items-center">
          <p class="text-center mt-10 text-2xl text-[#6a8477] font-bold">
            DRESS CODE
          </p>
          <p class="text-center">Elegante</p>
          <div class="flex">
            <Traje />
            <Vesitdo />
          </div>
          <img class="w-[250px] mt-10" src="3.png" alt="linea-corazon" />
          <div class="flex flex-col items-center">
            <p class="mt-10 uppercase">No es una fiesta si no suena...</p>
            <p class="font-semibold text-2xl mb-4 text-[#6a8477]">¬øQue tema?</p>
            <a
              class="self-center text-white bg-[#6a8477] flex px-8 py-4 gap-2 rounded-xl"
              href="https://open.spotify.com/playlist/5aeJSrKXf7iQSuBdGD97Dk?si=e07259073f3949c4&pt=00d0bb0699adf3745db6c80229eb60bb"
              target="_blank">Ingresa aqui y danos una mano</a
            >
          </div>
          <iframe
            style="border-radius:12px"
            src="https://open.spotify.com/embed/playlist/5aeJSrKXf7iQSuBdGD97Dk?utm_source=generator&theme=0"
            width="100%"
            height="152"
            frameBorder="0"
            allowfullscreen=""
            allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
            loading="lazy"></iframe>
        </div>
      </div>
    </section>
    <section
      class="w-full flex flex-col items-center relative px-10 py-10 text-[#6a8477]"
    >
      <img class="self-center w-[250px]" src="3.png" alt="linea-corazon" />
      <div class="mt-10 flex flex-col gap-6 max-w-[500px] text-center">
        <img
          class="aspect-square self-center w-[100px]"
          src="auto.png"
          alt="imagen de auto"
        />
        <div class="flex flex-col gap-6 items-center p-6 rounded-xl">
          <p class="text-xl">¬°Queridos amigos y familia!</p>
          <p>
            El mejor regalo que podr√≠amos recibir es tenerlos con nosotros para
            celebrar este d√≠a tan especial. Si sienten el deseo de compartir
            algo m√°s, encontrar√°n un buz√≥n en la fiesta donde podr√°n dejarnos un
            detalle especial que nos acompa√±ar√° en nuestra pr√≥xima aventura.
          </p>
          <p>¬°Nuestra luna de miel!.</p>
          <p>
            ¬°Gracias por ser parte de este momento tan importante en nuestras
            vidas!
          </p>
        </div>
      </div>
    </section>
    <img class="" src="Imagen-fondo2.webp" alt="" />
    <section
      id="formulario"
      class="w-full min-h-screen flex flex-col items-center gap-80 relative bg-[#6a8477] py-10 text-white px-10"
    >
      <div>
        <div class="flex flex-col gap-5 items-center">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="100"
            height="100"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-badge-check"
            ><path
              d="M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z"
            ></path><path d="m9 12 2 2 4-4"></path></svg
          >
          <p class="text-2xl">Confirmar Asistencia</p>
          <p>
            Por favor complet√° el formulario con tus datos y comentarios para
            organizar la mejor fiesta
          </p>
        </div>
        <form
          class="flex flex-col w-full gap-4 mt-5 text-black items-center"
          action={"/" + actions.formulario}
          method="POST"
        >
          <input
            class="py-3 px-5 w-full"
            type="text"
            placeholder="Nombre y apellido"
            name="nombre_y_apellido"
            transition:persist
          />

          <p
            id="nombre-error"
            class="text-red-700 text-xs self-start font-bold hidden"
          >
            *El campo de nombre y apellido es requerido
          </p>

          <input
            class="py-3 px-5 w-full"
            type="text"
            placeholder="Email"
            name="email"
            transition:persist
          />

          <p
            id="email-error"
            class="text-red-700 text-xs self-start font-bold hidden"
          >
            *El campo de email es requerido
          </p>

          <label class="text-white self-start" for="menu"
            >Opciones de men√∫</label
          >
          <select
            class="text-black py-3 px-5 w-full"
            name="menu"
            id="menu"
            transition:persist
          >
            <option selected disabled value="">Seleccionar Men√∫</option>
            <option value="menu-principal">Men√∫ Principal</option>
            <option value="menu-vegetariano">Men√∫ Vegetariano</option>
            <option value="menu-vegano">Men√∫ Vegano</option>
            <option value="menu-celiaco">Men√∫ Cel√≠aco</option>
          </select>

          <p
            id="menu-error"
            class="text-red-700 text-xs self-start font-bold hidden"
          >
            *Debes seleccionar un men√∫
          </p>

          <textarea
            class="text-black py-3 px-5 resize-none w-full"
            rows="6"
            placeholder="Com√©ntanos alguna situaci√≥n particular, como alergias u otras necesidades, que nos ayude a hacer de esta la mejor fiesta. O, si prefieres, simplemente d√©janos un saludo üòÅ"
            name="comentarios_y_saludos"
            transition:persist></textarea>
          <button
            class="bg-white text-[#6a8477] px-6 py-2 rounded-lg hover:bg-[#33423a] hover:text-white transition-colors ease-in-out duration-200"
            type="submit">Enviar</button
          >
        </form>
      </div>
    </section>
  </main>
</Layout>

<script>
  import { actions, isInputError } from "astro:actions";
  import Swal from "sweetalert2";

  const dias = document.getElementById("dias") as HTMLSpanElement;
  const horas = document.getElementById("horas") as HTMLSpanElement;
  const minutos = document.getElementById("minutos") as HTMLSpanElement;
  const segundos = document.getElementById("segundos") as HTMLSpanElement;
  const form = document.querySelector("form") as HTMLFormElement;
  const menu_error = document.getElementById(
    "menu-error"
  ) as HTMLParagraphElement;
  const nombre_error = document.getElementById(
    "nombre-error"
  ) as HTMLParagraphElement;
  const email_error = document.getElementById(
    "email-error"
  ) as HTMLParagraphElement;

  const weddingDate = new Date("2025-03-02T22:00:00Z").getTime();
  const updateTime = () => {
    const now = new Date().getTime();
    const dif = weddingDate - now;
    const days = Math.floor(dif / (1000 * 60 * 60 * 24));
    const hours = Math.floor((dif % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((dif % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((dif % (1000 * 60)) / 1000);

    dias.innerText = days.toString().padStart(2, "0");
    horas.innerText = hours.toString().padStart(2, "0");
    minutos.innerText = minutes.toString().padStart(2, "0");
    segundos.innerText = seconds.toString().padStart(2, "0");
  };

  setInterval(updateTime, 1000);

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    const { error } = await actions.formulario(formData);
    if (isInputError(error)) {
      Swal.fire({
        text: "Por favor, revisa los campos que faltan",
        icon: "error",
        toast: true,
        timer: 3000,
        position: "bottom-right",
        showConfirmButton: false,
        background: "#ffe7e7",
        color: "red",
      });
      if (error.fields.menu) {
        menu_error.classList.remove("hidden");
      } else {
        menu_error.classList.add("hidden");
      }
      if (error.fields.nombre_y_apellido) {
        nombre_error.classList.remove("hidden");
      } else {
        nombre_error.classList.add("hidden");
      }
      if (error.fields.email) {
        email_error.classList.remove("hidden");
      } else {
        email_error.classList.add("hidden");
      }
    } else {
      email_error.classList.add("hidden");
      nombre_error.classList.add("hidden");
      menu_error.classList.add("hidden");
      Swal.fire({
        text: "¬°Gracias por tu asistencia!",
        icon: "success",
        toast: true,
        timer: 3000,
        position: "bottom-right",
        showConfirmButton: false,
        background: "#e7ffe7",
        color: "green",
      });
      form.reset();
    }
  });
</script>
